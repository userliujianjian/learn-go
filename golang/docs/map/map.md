## map类型常见问题

- key为什么是无序的？(迭代map是无序的从go 1.0开始加入)
  - map 在扩容后会放生key的搬迁，原来坐落在同一个bucket中的key，搬迁后有些key就远走高飞了
  - GO在遍历map时，并不是固定的从0号bucket开始的，每次遍历都是从一个随机值序号的bucket开始，而且是从这个bucket中随机一个序号开始cell，这样即使你写死一个map，仅仅是遍历它，也不太可能返回一个固定顺序的key/value


- 可以遍历删除元素嘛？
	- map并不是一个县城安全的数据结构。同时读写一个map是未定义的行为，如果被检测到会直接panic（多协程同时读写同一个map的情况下）
	- 同一写成内边遍历边删除，并不会检测到同时读写，理论上是可以这样做的
	- 但是遍历结果可能就不会想通了，有可能遍历结果中包含了删除的key，也有可能不包含，这取决于删除key的时间，是在遍历到key所在的bucket时刻之前或之后。

	- 一般而言，这可以通过读写锁解决：sync.RWMutex
	> sync.Map是县城安全的map

- 可以对map的元素取址嘛？
	- 无法对map的key或value进行取址。  
	- 因为unsafe.Pointer等获得key或value地址，也不能长期持有，一旦发生扩容，key和value的位置就会改变，之前保存的地址也就失效了

- 如何表两个map相等？
	- 只能遍历map的每个元素，比较元素是否都是深度相等。

- map是线程安全的嘛？
	- 在查找、赋值、遍历、删除的过程中都会检测写标志，一旦发现写标志位（等于1），则直接panic
	- 赋值和删除函数在检测完写标志是复位后，先将写标志置位才会进行之后操作
	> map 不是线程安全的
